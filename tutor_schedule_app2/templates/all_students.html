{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–º–∏</p>
    </div>
    
    <div class="students-controls">
        <a href="{{ url_for('add_student') }}" class="btn btn-primary">
            üë§ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞
        </a>
        <form class="search-form" action="{{ url_for('all_students') }}" method="GET">
            <input type="search" 
                   placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û –∏–ª–∏ Telegram ID" 
                   name="search" 
                   value="{{ search_query }}"
                   class="search-input">
            <button class="btn btn-secondary" type="submit">üîç –ü–æ–∏—Å–∫</button>
        </form>
    </div>
</div>

<div class="card">
    {% if students %}
        <table class="table">
            <thead>
                <tr>
                    <th>–§–ò–û</th>
                    {% if current_user.role == 'admin' %}<th>–†–µ–ø–µ—Ç–∏—Ç–æ—Ä</th>{% endif %}
                    <th>Chat ID</th>
                    <th>–í—Å–µ–≥–æ –∑–∞–Ω—è—Ç–∏–π</th>
                    <th>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>
                        <strong>{{ student.full_name }}</strong>
                    </td>
                    {% if current_user.role == 'admin' %}
                    <td>
                        {% if student.tutor %}
                            <span class="tutor-badge">{{ student.tutor.username }}</span>
                        {% else %}
                            <span class="text-muted">–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</span>
                        {% endif %}
                    </td>
                    {% endif %}
                    <td>
                        {% if student.telegram_chat_id %}
                            <code>{{ student.telegram_chat_id }}</code>
                        {% else %}
                            <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="lesson-count">{{ student.lessons_count }}</span>
                    </td>
                    <td>
                        {% if student.receive_notifications %}
                            <span class="status-badge status-active">–í–∫–ª—é—á–µ–Ω—ã</span>
                        {% else %}
                            <span class="status-badge status-cancelled">–û—Ç–∫–ª—é—á–µ–Ω—ã</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('view_student_card', student_id=student.id) }}" 
                               class="btn btn-primary btn-sm">
                                üë§ –ö–∞—Ä—Ç–æ—á–∫–∞
                            </a>
                            <a href="{{ url_for('delete_student', student_id=student.id) }}" 
                               class="btn btn-danger btn-sm" 
                               onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">üë•</div>
            <h3>–°—Ç—É–¥–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>{% if search_query %}–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.{% else %}–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.{% endif %}</p>
            {% if not search_query %}
                <a href="{{ url_for('add_student') }}" class="btn btn-primary">
                    üë§ –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>

<style>
.tutor-badge {
    background: #e3f2fd;
    color: #1976d2;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 500;
    border: 1px solid #bbdefb;
}
</style>
{% endblock %}