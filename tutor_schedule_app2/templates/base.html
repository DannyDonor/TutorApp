<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TutorApp{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="main-container">
    <nav class="navbar">
        <div class="navbar-left">
            <div class="navbar-brand">TutorApp</div>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="navbar-nav" id="navbar-nav">
                {% if session.role == 'admin' %}
                    <a href="{{ url_for('admin_panel') }}" class="nav-link primary">üõ†Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                    <a href="{{ url_for('today_lessons') }}" class="nav-link">üìÖ –°–µ–≥–æ–¥–Ω—è</a>
                    <a href="{{ url_for('all_students') }}" class="nav-link">üë• –°—Ç—É–¥–µ–Ω—Ç—ã</a>
                    <a href="{{ url_for('all_lessons') }}" class="nav-link">üìö –£—Ä–æ–∫–∏</a>
                    <a href="{{ url_for('statistics') }}" class="nav-link">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                    <a href="{{ url_for('analytics_dashboard') }}" class="nav-link">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                    <a href="{{ url_for('courses_list') }}" class="nav-link">üéì –ö—É—Ä—Å—ã</a>
                    <a href="{{ url_for('manage_users') }}" class="nav-link">‚öôÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                    <a href="{{ url_for('pending_approvals') }}" class="nav-link warning">‚è≥ –û–¥–æ–±—Ä–µ–Ω–∏—è</a>
                {% elif session.role == 'tutor' %}
                    <a href="{{ url_for('today_lessons') }}" class="nav-link">üìÖ –°–µ–≥–æ–¥–Ω—è</a>
                    <a href="{{ url_for('all_students') }}" class="nav-link">üë• –°—Ç—É–¥–µ–Ω—Ç—ã</a>
                    <a href="{{ url_for('all_lessons') }}" class="nav-link">üìö –£—Ä–æ–∫–∏</a>
                    <a href="{{ url_for('pending_homeworks') }}" class="nav-link">
                        üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–ó
                        {% if pending_homeworks_count > 0 %}
                            <span class="notification-badge">{{ pending_homeworks_count }}</span>
                        {% endif %}
                    </a>
                    <a href="{{ url_for('tutor_submissions') }}" class="nav-link">
                        üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π –∫—É—Ä—Å–æ–≤
                    </a>
                    <a href="{{ url_for('statistics') }}" class="nav-link">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                    <a href="{{ url_for('analytics_dashboard') }}" class="nav-link">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                    <a href="{{ url_for('courses_list') }}" class="nav-link">üéì –ö—É—Ä—Å—ã</a>
                {% elif session.role == 'student' %}
                    <a href="{{ url_for('student_dashboard') }}" class="nav-link">üìñ –ú–æ–∏ —É—Ä–æ–∫–∏</a>
                    <a href="{{ url_for('student_courses') }}" class="nav-link">üìö –ú–æ–∏ –∫—É—Ä—Å—ã</a>
                    <a href="{{ url_for('student_homework') }}" class="nav-link">üìù –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</a>
                {% endif %}
            </div>
        </div>
        <div class="navbar-user">
            <div class="user-dropdown" onclick="toggleDropdown()">
                <div class="user-button">
                    <div class="user-avatar">
                        {{ session.username[0].upper() }}
                    </div>
                    <div class="user-info">
                        <div class="user-name">{{ session.username }}</div>
                        <div class="user-role">{{ session.role }}</div>
                    </div>
                    <span class="dropdown-arrow">‚ñº</span>
                </div>
                <div class="dropdown-menu">
                    <a href="{{ url_for('index') }}" class="dropdown-item">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="{{ url_for('user_settings') }}" class="dropdown-item">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                    {% if session.role == 'admin' %}
                        <a href="{{ url_for('manage_users') }}" class="dropdown-item">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                        <a href="{{ url_for('pending_approvals') }}" class="dropdown-item">‚è≥ –û–∂–∏–¥–∞—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è</a>
                        <a href="{{ url_for('admin_security') }}" class="dropdown-item">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}" class="dropdown-item danger">üö™ –í—ã–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="content">
        
        <!-- Flash —Å–æ–æ–±—â–µ–Ω–∏—è -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </div>

    <script>
        function toggleDropdown() {
            const dropdown = document.querySelector('.user-dropdown');
            dropdown.classList.toggle('active');
        }

        function toggleMobileMenu() {
            const nav = document.getElementById('navbar-nav');
            const toggle = document.querySelector('.mobile-menu-toggle');
            nav.classList.toggle('active');
            toggle.classList.toggle('active');
        }

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.user-dropdown');
            if (!dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–∞–º dropdown
        document.querySelector('.user-dropdown').addEventListener('click', function(event) {
            event.stopPropagation();
        });

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('navbar-nav').classList.remove('active');
                document.querySelector('.mobile-menu-toggle').classList.remove('active');
            }
        });
    </script>
</body>
</html>