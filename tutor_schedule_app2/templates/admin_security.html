{% extends "base.html" %}

{% block title %}–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - TutorApp{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>üîí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é</h2>
        <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º</p>
    </div>
    
    <div class="security-stats">
        <div class="stat-card">
            <h3>{{ active_sessions|length }}</h3>
            <span>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π</span>
        </div>
    </div>
    
    {% if active_sessions %}
    <h3>üîê –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏</h3>
    <table class="table">
        <thead>
            <tr>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>–†–æ–ª—å</th>
                <th>Email</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for user in active_sessions %}
            <tr>
                <td>
                    <strong>{{ user.username }}</strong>
                    {% if not user.is_active %}
                        <span class="status-badge status-cancelled">–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</span>
                    {% endif %}
                </td>
                <td>
                    <span class="role-badge role-{{ user.role }}">
                        {% if user.role == 'admin' %}üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                        {% elif user.role == 'tutor' %}üë®‚Äçüè´ –†–µ–ø–µ—Ç–∏—Ç–æ—Ä
                        {% elif user.role == 'student' %}üéì –°—Ç—É–¥–µ–Ω—Ç
                        {% else %}{{ user.role }}
                        {% endif %}
                    </span>
                </td>
                <td>{{ user.email }}</td>
                <td>
                    {% if user.reset_token %}
                        <span class="status-badge status-active">–ê–∫—Ç–∏–≤–Ω–∞</span>
                    {% else %}
                        <span class="status-badge status-inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                    {% endif %}
                </td>
                <td>
                    {% if user.reset_token %}
                    <form method="POST" action="{{ url_for('revoke_user_session', user_id=user.id) }}" 
                          style="display: inline;"
                          onsubmit="return confirm('–û—Ç–æ–∑–≤–∞—Ç—å —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}?')">
                        <button type="submit" class="btn btn-sm btn-warning">
                            üö´ –û—Ç–æ–∑–≤–∞—Ç—å —Å–µ—Å—Å–∏—é
                        </button>
                    </form>
                    {% else %}
                        <span class="text-muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="alert alert-info">
        <h3>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π</h3>
        <p>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∏ –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
    </div>
    {% endif %}
    
    <div class="security-actions">
        <h3>‚öôÔ∏è –î–µ–π—Å—Ç–≤–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
        <div class="action-buttons">
            <button onclick="alert('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" class="btn btn-secondary">
                üìä –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
            </button>
            <button onclick="alert('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" class="btn btn-secondary">
                üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –≤—Å–µ—Ö
            </button>
        </div>
    </div>
</div>

<style>
.security-stats {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, var(--primary-color), #667eea);
    color: white;
    padding: 1.5rem;
    border-radius: var(--radius);
    text-align: center;
    min-width: 150px;
}

.stat-card h3 {
    font-size: 2.5em;
    margin: 0;
    font-weight: bold;
}

.stat-card span {
    font-size: 0.9em;
    opacity: 0.9;
}

.role-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 500;
}

.role-admin {
    background: #ffd700;
    color: #8b4513;
}

.role-tutor {
    background: #e3f2fd;
    color: #1976d2;
}

.role-student {
    background: #e8f5e8;
    color: #2e7d32;
}

.security-actions {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #eee;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.status-active {
    background: #d4edda;
    color: #155724;
}

.status-inactive {
    background: #f8d7da;
    color: #721c24;
}
</style>
{% endblock %}