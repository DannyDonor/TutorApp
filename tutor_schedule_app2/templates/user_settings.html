{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - TutorApp{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
    </div>
    
    <form method="POST" class="auth-form">
        {% if current_user.role in ['admin', 'tutor'] %}
        <div class="section-header">
            <h3>ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞</h3>
            <p class="permission-notice">
                {% if current_user.role == 'admin' %}
                    <span class="badge badge-admin">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                {% else %}
                    <span class="badge badge-tutor">üë®‚Äçüè´ –†–µ–ø–µ—Ç–∏—Ç–æ—Ä</span>
                {% endif %}
                –î–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
            </p>
        </div>
        
        <div class="form-group">
            <label for="bot_token">üîë –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞</label>
            <input type="text" id="bot_token" name="bot_token" 
                   value="{{ current_user.bot_token or '' }}"
                   placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
            <small class="form-text">
                –¢–æ–∫–µ–Ω –æ–±—â–µ–≥–æ Telegram –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º. 
                –ü–æ–ª—É—á–∏—Ç—å –º–æ–∂–Ω–æ —É <a href="https://t.me/BotFather" target="_blank">@BotFather</a>
            </small>
        </div>
        
        <div class="alert alert-info">
            <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –±–æ—Ç–∞:</h4>
            <ol>
                <li>–ù–∞–ø–∏—à–∏—Ç–µ <a href="https://t.me/BotFather" target="_blank">@BotFather</a> –≤ Telegram</li>
                <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/newbot</code></li>
                <li>–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞</li>
                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤—ã—à–µ</li>
                <li>–î–æ–±–∞–≤—å—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ —á–∞—Ç—ã —Å–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ –∏ —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏</li>
            </ol>
            
            <div class="alert-warning">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –≠—Ç–æ—Ç —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π 
                –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞, –≤—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã 
                –¥–æ–ª–∂–Ω—ã –±—É–¥—É—Ç –∑–∞–Ω–æ–≤–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –Ω–æ–≤—ã–º –±–æ—Ç–æ–º.
            </div>
        </div>
        
        <hr>
        {% else %}
        <div class="section-header">
            <h3>ü§ñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram –±–æ—Ç–µ</h3>
        </div>
        
        <div class="alert alert-info">
            <h4>‚ÑπÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h4>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤–∞—à–∏–º —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–º –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —Å–∏—Å—Ç–µ–º—ã.</p>
            <p>–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—É.</p>
            
            <div class="bot-status">
                {% if current_user.student and current_user.student.telegram_chat_id %}
                    <span class="status-badge status-on">‚úÖ Telegram –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>
                    <p>Chat ID: <code>{{ current_user.student.telegram_chat_id }}</code></p>
                {% else %}
                    <span class="status-badge status-off">‚ùå Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>
                    <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
                {% endif %}
            </div>
        </div>
        
        <hr>
        {% endif %}
        
        <div class="section-header">
            <h3>üîê –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</h3>
        </div>
        
        <div class="form-group">
            <label for="current_password">üîí –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
            <input type="password" id="current_password" name="current_password" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
        </div>
        
        <div class="form-group">
            <label for="new_password">üÜï –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
            <input type="password" id="new_password" name="new_password" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
        </div>
        
        <div class="form-group">
            <label for="confirm_password">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
            <input type="password" id="confirm_password" name="confirm_password" 
                   placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">‚ùå –û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h2>üì± –ü–æ–ª—É—á–µ–Ω–∏–µ Chat ID</h2>
        <p>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ —Ä–æ–¥–∏—Ç–µ–ª–µ–π</p>
    </div>
    
    <div class="alert alert-warning">
        <h4>‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:</h4>
        <p>–°—Ç—É–¥–µ–Ω—Ç—ã –∏ —Ä–æ–¥–∏—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ @username, –∞ —á–∏—Å–ª–æ–≤–æ–π Chat ID.</p>
        
        <h5>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Chat ID:</h5>
        <ol>
            <li>–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ–º—É –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</li>
            <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: <code>https://api.telegram.org/bot[–í–ê–®_–¢–û–ö–ï–ù]/getUpdates</code></li>
            <li>–ó–∞–º–µ–Ω–∏—Ç–µ [–í–ê–®_–¢–û–ö–ï–ù] –Ω–∞ —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞</li>
            <li>–í –æ—Ç–≤–µ—Ç–µ –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª–µ <code>"chat":{"id":123456789}</code></li>
            <li>–ß–∏—Å–ª–æ 123456789 - —ç—Ç–æ –∏ –µ—Å—Ç—å Chat ID</li>
        </ol>
        
        <p><strong>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ <a href="https://t.me/userinfobot" target="_blank">@userinfobot</a> - –æ–Ω –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à Chat ID.</p>
    </div>
</div>

<style>
.permission-notice {
    margin: 0.5rem 0;
    font-size: 0.9rem;
    color: #666;
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-right: 0.5rem;
}

.badge-admin {
    background: #ede9fe;
    color: #5b21b6;
    border: 1px solid #c4b5fd;
}

.badge-tutor {
    background: #dbeafe;
    color: #1e40af;
    border: 1px solid #93c5fd;
}

.bot-status {
    margin-top: 1rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid var(--primary-color);
}

.status-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.status-badge.status-on {
    background: #d1fae5;
    color: #065f46;
    border: 1px solid #a7f3d0;
}

.status-badge.status-off {
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fca5a5;
}

.alert-warning {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    color: #856404;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
}

.section-header {
    margin: 1.5rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--primary-color);
}

.section-header h3 {
    margin: 0 0 0.5rem 0;
    color: var(--primary-color);
}

.section-header p {
    margin: 0;
    color: #666;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .badge {
        display: block;
        margin: 0.25rem 0;
        text-align: center;
    }
    
    .bot-status {
        padding: 0.75rem;
    }
}
</style>
{% endblock %}