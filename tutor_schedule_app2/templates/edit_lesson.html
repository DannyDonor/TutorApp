{% extends "base.html" %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>üìù –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è –∏ –æ—Ç—á–µ—Ç</h2>
        <p>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞</p>
    </div>
    
    <form method="POST" class="auth-form">
        <div class="form-group">
            <label for="date_time">üïê –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
            <input type="datetime-local" id="date_time" name="date_time"
                   value="{{ current_time }}" required>
        </div>
        
        <div class="form-group">
            <label>üë§ –°—Ç—É–¥–µ–Ω—Ç</label>
            <input type="text" value="{{ student.full_name }}" readonly>
        </div>

        <hr>
        <div class="section-header">
            <h3>üìã –û—Ç—á–µ—Ç –æ –∑–∞–Ω—è—Ç–∏–∏</h3>
        </div>

        <div class="form-group">
            <label for="report_status">üìä –°—Ç–∞—Ç—É—Å –∑–∞–Ω—è—Ç–∏—è</label>
            <select id="report_status" name="report_status">
                <option value="–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω" {% if lesson.status == '–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω' %}selected{% endif %}>‚è∞ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</option>
                <option value="–ø—Ä–æ–≤–µ–¥–µ–Ω" {% if lesson.status == '–ø—Ä–æ–≤–µ–¥–µ–Ω' %}selected{% endif %}>‚úÖ –ü—Ä–æ–≤–µ–¥–µ–Ω–æ</option>
                <option value="–æ—Ç–º–µ–Ω–µ–Ω" {% if lesson.status == '–æ—Ç–º–µ–Ω–µ–Ω' %}selected{% endif %}>‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ</option>
                <option value="–Ω–µ_–ø—Ä–∏—à–µ–ª" {% if lesson.status == '–Ω–µ_–ø—Ä–∏—à–µ–ª' %}selected{% endif %}>üëª –°—Ç—É–¥–µ–Ω—Ç –Ω–µ –ø—Ä–∏—à–µ–ª</option>
            </select>
        </div>

        <div class="form-group">
            <label for="topic_covered">üìö –¢–µ–º–∞ –∑–∞–Ω—è—Ç–∏—è</label>
            <input type="text" id="topic_covered" name="topic_covered" 
                   value="{{ lesson.topic_covered or '' }}"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É —É—Ä–æ–∫–∞">
        </div>

        <div class="form-group">
            <label for="video_status">üé• –°—Ç–∞—Ç—É—Å –≤–∏–¥–µ–æ</label>
            <select id="video_status" name="video_status" onchange="toggleVideoLink()">
                <option value="pending" {% if lesson.video_status == 'pending' or not lesson.video_status %}selected{% endif %}>‚è≥ –ù–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</option>
                <option value="added" {% if lesson.video_status == 'added' %}selected{% endif %}>‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å</option>
                <option value="later" {% if lesson.video_status == 'later' %}selected{% endif %}>‚è∞ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ</option>
            </select>
        </div>

        <div class="form-group" id="video_link_group" style="display: none;">
            <label for="video_link">üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ</label>
            <input type="url" id="video_link" name="video_link" 
                   value="{{ lesson.video_link or '' }}"
                   placeholder="https://example.com/video">
            <small class="form-text">–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∑–∞–ø–∏—Å—å —É—Ä–æ–∫–∞</small>
        </div>

        <div class="form-group">
            <label for="homework_description">üìù –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</label>
            <textarea id="homework_description" name="homework_description" 
                      rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ">{{ lesson.homework.description if lesson.homework else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="next_lesson_date">üìÖ –°–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ</label>
            <input type="datetime-local" id="next_lesson_date" name="next_lesson_date"
                   value="{{ lesson.next_lesson_date.strftime('%Y-%m-%dT%H:%M') if lesson.next_lesson_date else '' }}">
            <small class="form-text">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</small>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á–µ—Ç</button>
            <a href="{{ url_for('today_lessons') }}" class="btn btn-secondary">‚ùå –û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
function toggleVideoLink() {
    const videoStatus = document.getElementById('video_status').value;
    const videoLinkGroup = document.getElementById('video_link_group');
    const videoLinkInput = document.getElementById('video_link');
    
    if (videoStatus === 'added') {
        videoLinkGroup.style.display = 'block';
        videoLinkInput.required = true;
    } else {
        videoLinkGroup.style.display = 'none';
        videoLinkInput.required = false;
        if (videoStatus === 'later') {
            videoLinkInput.value = '';
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    toggleVideoLink();
});
</script>
{% endblock %}